# Web Vitals Monitor - Демонстрация

Подробное руководство по работе browser extension для мониторинга Core Web Vitals.

## 🚀 Установка расширения

### Шаг 1: Загрузка в режиме разработчика (Chrome/Edge)

```
1. Откройте chrome://extensions/
2. Включите "Developer mode" (переключатель в правом верхнем углу)
3. Нажмите "Load unpacked"
4. Выберите папку web-vitals-monitor
5. Расширение появится в списке с иконкой 📊
```

### Шаг 2: Закрепление расширения

```
1. Нажмите на иконку расширений (пазл) в верхнем правом углу браузера
2. Найдите "Web Vitals Monitor"
3. Нажмите на булавку, чтобы закрепить его
4. Теперь иконка расширения всегда видна в toolbar
```

---

## 📊 Основной интерфейс (Popup)

### Внешний вид

Когда вы нажимаете на иконку расширения, открывается popup размером 500x600px с темным интерфейсом:

```
┌─────────────────────────────────────┐
│ Web Vitals Monitor          ⚙️      │  ← Заголовок и кнопка настроек
├─────────────────────────────────────┤
│                                     │
│  ┌──────────┐  ┌──────────┐        │
│  │   LCP    │  │   FID    │        │  ← Метрики (2x2 сетка)
│  │ 2100ms   │  │  45ms    │        │
│  │ ✓ Good   │  │ ✓ Good   │        │
│  └──────────┘  └──────────┘        │
│                                     │
│  ┌──────────┐  ┌──────────┐        │
│  │   CLS    │  │   INP    │        │
│  │  0.08    │  │  120ms   │        │
│  │ ✓ Good   │  │ ✓ Good   │        │
│  └──────────┘  └──────────┘        │
│                                     │
├─ Additional Metrics ────────────────┤
│ TTFB:  450ms                        │
│ FCP:   800ms                        │
│ DCL:   1200ms                       │
│ Load:  2500ms                       │
├─────────────────────────────────────┤
│ [📊 Dashboard]  [📥 Export]         │  ← Кнопки действий
├─────────────────────────────────────┤
│ Documentation        v1.0.0         │  ← Footer
└─────────────────────────────────────┘
```

### Каждая метрика показывает:

1. **Название метрики** (LCP, FID, CLS, INP)
2. **Текущее значение** с единицами (ms или число)
3. **Статус**:
   - ✓ Good (зеленый) — метрика в норме
   - ⚠ Needs Improvement (желтый) — требует внимания
   - ✗ Poor (красный) — критическая проблема
4. **Описание** (Largest Contentful Paint, First Input Delay, и т.д.)

### Цветовая кодировка

```
LCP метрика:
┌─────────────────────────────────────┐
│ LCP                                 │
│ 2100ms                              │
│ ✓ Good (зеленый фон)                │  ← ≤ 2.5s
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ LCP                                 │
│ 3200ms                              │
│ ⚠ Needs Improvement (желтый фон)    │  ← 2.5s - 4s
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ LCP                                 │
│ 4500ms                              │
│ ✗ Poor (красный фон)                │  ← > 4s
└─────────────────────────────────────┘
```

---

## ⚙️ Настройки (Settings Modal)

### Открытие настроек

Нажмите кнопку ⚙️ в верхнем правом углу popup:

```
┌─────────────────────────────────────┐
│ Settings                        ✕   │
├─────────────────────────────────────┤
│                                     │
│ ☐ Auto-export metrics               │
│ ☑ Show notifications                │
│ ☐ Dark mode                         │
│                                     │
│ LCP Threshold (ms)                  │
│ [2500________________]              │
│                                     │
│ CLS Threshold                       │
│ [0.1________________]               │
│                                     │
├─────────────────────────────────────┤
│ [Reset]            [Save]           │
└─────────────────────────────────────┘
```

### Доступные настройки

1. **Auto-export metrics** — автоматически экспортировать данные
2. **Show notifications** — показывать уведомления при превышении порогов
3. **Dark mode** — переключить на темную тему
4. **LCP Threshold** — порог для алерта LCP (по умолчанию 2500ms)
5. **CLS Threshold** — порог для алерта CLS (по умолчанию 0.1)

### Пример использования настроек

```
Сценарий: Вы хотите получать алерты только для очень плохой производительности

1. Откройте Settings
2. Измените LCP Threshold на 5000 (вместо 2500)
3. Измените CLS Threshold на 0.25 (вместо 0.1)
4. Включите "Show notifications"
5. Нажмите "Save"

Теперь вы будете получать уведомления только для критических проблем!
```

---

## 📊 Dashboard (Полная аналитика)

### Открытие Dashboard

Нажмите кнопку **[📊 Dashboard]** в popup:

```
Откроется новая вкладка с полной аналитикой всех посещенных сайтов
```

### Структура Dashboard

```
┌────────────────────────────────────────────────────────────────┐
│ 📊 Web Vitals Dashboard          [🔄 Refresh]  [🗑️ Clear Data] │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│ Monitored Sites                                                │
│ ┌──────────────────┐  ┌──────────────────┐  ┌──────────────┐ │
│ │ example.com      │  │ github.com       │  │ google.com   │ │
│ │ LCP: 2100ms      │  │ LCP: 1800ms      │  │ LCP: 2300ms  │ │
│ │ FID: 45ms        │  │ FID: 30ms        │  │ FID: 50ms    │ │
│ │ CLS: 0.08        │  │ CLS: 0.05        │  │ CLS: 0.12    │ │
│ │ INP: 120ms       │  │ INP: 100ms       │  │ INP: 150ms   │ │
│ └──────────────────┘  └──────────────────┘  └──────────────┘ │
│                                                                │
│ Performance Trends                                             │
│ ┌──────────────────────┐  ┌──────────────────────┐           │
│ │ LCP Over Time        │  │ CLS Over Time        │           │
│ │                      │  │                      │           │
│ │    /\    /\          │  │   ___  ___           │           │
│ │   /  \  /  \         │  │  |   ||   |          │           │
│ │  /    \/    \        │  │  |___|___|          │           │
│ │ ────────────────     │  │ ────────────────     │           │
│ └──────────────────────┘  └──────────────────────┘           │
│                                                                │
│ ┌──────────────────────┐  ┌──────────────────────┐           │
│ │ FID Over Time        │  │ INP Over Time        │           │
│ │                      │  │                      │           │
│ │    ___  ___          │  │   /\    /\           │           │
│ │   |   ||   |         │  │  /  \  /  \          │           │
│ │   |___|___|         │  │ /    \/    \         │           │
│ │ ────────────────     │  │ ────────────────     │           │
│ └──────────────────────┘  └──────────────────────┘           │
│                                                                │
│ Statistics                                                     │
│ ┌──────────────────┐  ┌──────────────────┐                   │
│ │ Total Sites: 3   │  │ Total Metrics: 150                  │
│ └──────────────────┘  └──────────────────┘                   │
│ ┌──────────────────┐  ┌──────────────────┐                   │
│ │ Good LCP: 2      │  │ Good CLS: 3      │                   │
│ └──────────────────┘  └──────────────────┘                   │
│                                                                │
├────────────────────────────────────────────────────────────────┤
│ Documentation | Report Issue                    v1.0.0        │
└────────────────────────────────────────────────────────────────┘
```

### Компоненты Dashboard

#### 1. Monitored Sites (Отслеживаемые сайты)

Карточки для каждого посещенного сайта:

```
┌──────────────────┐
│ example.com      │  ← Домен (кликабельный)
│ LCP: 2100ms      │
│ FID: 45ms        │
│ CLS: 0.08        │
│ INP: 120ms       │
└──────────────────┘
```

#### 2. Performance Trends (Тренды производительности)

Четыре графика (Line Charts) с использованием Chart.js:

- **LCP Over Time** — зеленая линия, показывает тренд LCP
- **CLS Over Time** — желтая линия, показывает тренд CLS
- **FID Over Time** — синяя линия, показывает тренд FID
- **INP Over Time** — фиолетовая линия, показывает тренд INP

Каждый график показывает последние 20 измерений.

#### 3. Statistics (Статистика)

Четыре карточки с ключевыми метриками:

```
┌──────────────────────────────┐
│ Total Sites Monitored        │
│ 3                            │
└──────────────────────────────┘

┌──────────────────────────────┐
│ Total Metrics Collected      │
│ 150                          │
└──────────────────────────────┘

┌──────────────────────────────┐
│ Sites with Good LCP          │
│ 2                            │
└──────────────────────────────┘

┌──────────────────────────────┐
│ Sites with Good CLS          │
│ 3                            │
└──────────────────────────────┘
```

---

## 📥 Экспорт данных

### Как экспортировать

1. Откройте popup расширения на любом сайте
2. Нажмите кнопку **[📥 Export]**
3. Браузер автоматически скачает JSON файл

### Формат экспортированного файла

```json
{
  "url": "https://example.com",
  "title": "Example Domain",
  "timestamp": "2024-01-15T10:30:45.123Z",
  "metrics": {
    "latest": {
      "lcp": 2100,
      "fid": 45,
      "cls": 0.08,
      "inp": 120,
      "ttfb": 450,
      "fcp": 800,
      "dcl": 1200,
      "load": 2500
    },
    "history": [
      {
        "name": "lcp",
        "value": 2100,
        "timestamp": 1705316445123
      },
      {
        "name": "fid",
        "value": 45,
        "timestamp": 1705316446000
      },
      ...
    ]
  }
}
```

### Использование экспортированных данных

```bash
# Анализ данных в Python
import json

with open('web-vitals-2024-01-15.json') as f:
    data = json.load(f)

# Получить среднее значение LCP
lcp_values = [m['value'] for m in data['metrics']['history'] if m['name'] == 'lcp']
avg_lcp = sum(lcp_values) / len(lcp_values)
print(f"Average LCP: {avg_lcp}ms")
```

---

## 🔔 Уведомления (Notifications)

### Когда появляются уведомления

Если включена опция "Show notifications" в настройках, вы будете получать уведомления:

```
Пример 1: LCP превышает порог
┌─────────────────────────────────┐
│ Web Vitals Alert                │
│ ⚠ LCP is 4500ms (threshold: 2500ms)
│ Example Domain                  │
└─────────────────────────────────┘

Пример 2: CLS превышает порог
┌─────────────────────────────────┐
│ Web Vitals Alert                │
│ ⚠ CLS is 0.35 (threshold: 0.1)  │
│ Example Domain                  │
└─────────────────────────────────┘
```

### Как работают уведомления

1. Расширение постоянно мониторит метрики
2. Когда метрика превышает установленный порог, срабатывает алерт
3. Уведомление появляется в правом нижнем углу экрана
4. Уведомление исчезает через 5 секунд или при клике

---

## 🔄 Как работает расширение (Технический процесс)

### Шаг 1: Загрузка страницы

```
Пользователь открывает https://example.com
                    ↓
Браузер загружает страницу
                    ↓
Content Script (content.js) инжектируется в страницу
                    ↓
Injected Script (inject.js) начинает измерять метрики
```

### Шаг 2: Измерение метрик

```
Injected Script использует Web APIs:

1. PerformanceObserver для LCP
   ├─ Отслеживает largest-contentful-paint события
   └─ Отправляет значение когда LCP готов

2. PerformanceObserver для FID
   ├─ Отслеживает first-input события
   └─ Отправляет значение при первом взаимодействии

3. PerformanceObserver для CLS
   ├─ Отслеживает layout-shift события
   └─ Суммирует все сдвиги (исключая те после взаимодействия)

4. PerformanceObserver для INP
   ├─ Отслеживает event события
   └─ Отправляет максимальную длительность

5. Performance API для TTFB, FCP, DCL, Load
   ├─ Читает timing данные из navigation timing
   └─ Вычисляет разницу между временами
```

### Шаг 3: Отправка данных

```
Injected Script отправляет метрики через window.postMessage()
                    ↓
Content Script получает сообщение
                    ↓
Content Script отправляет в Background Service Worker через chrome.runtime.sendMessage()
                    ↓
Background Service Worker сохраняет в chrome.storage.local
```

### Шаг 4: Отображение в UI

```
Пользователь нажимает на иконку расширения
                    ↓
Popup.js запрашивает данные из storage
                    ↓
Данные отображаются в popup с цветовой кодировкой
                    ↓
Каждую секунду popup обновляется (setInterval)
```

---

## 📈 Примеры использования

### Пример 1: Отслеживание производительности сайта

```
Сценарий: Вы разработчик и хотите следить за производительностью вашего сайта

1. Откройте ваш сайт в браузере
2. Нажмите на иконку расширения
3. Посмотрите метрики LCP, FID, CLS
4. Если есть проблемы (красные статусы), откройте DevTools
5. Используйте Chrome DevTools Performance tab для детального анализа
6. Сделайте оптимизацию
7. Обновите страницу и проверьте метрики снова
```

### Пример 2: Сравнение производительности разных сайтов

```
Сценарий: Вы хотите сравнить производительность конкурентов

1. Посетите сайт конкурента 1
2. Посетите сайт конкурента 2
3. Посетите сайт конкурента 3
4. Откройте Dashboard
5. Посмотрите карточки всех сайтов
6. Сравните метрики LCP, FID, CLS
7. Экспортируйте данные для отчета
```

### Пример 3: Мониторинг производительности во времени

```
Сценарий: Вы хотите отследить, как производительность меняется за день

1. Утром: откройте сайт, посмотрите метрики
2. В обед: откройте сайт снова, посмотрите метрики
3. Вечером: откройте сайт еще раз, посмотрите метрики
4. Откройте Dashboard
5. Посмотрите графики "Performance Trends"
6. Видите, как метрики меняются в течение дня
7. Можете определить, когда сайт работает медленнее
```

---

## 🎯 Целевые значения метрик

### Что означают статусы

```
LCP (Largest Contentful Paint)
┌─────────────────────────────────────┐
│ ✓ Good        ≤ 2.5s                │  Отличная производительность
│ ⚠ Needs Imp.  2.5s - 4.0s           │  Требует оптимизации
│ ✗ Poor        > 4.0s                │  Критическая проблема
└─────────────────────────────────────┘

FID (First Input Delay)
┌─────────────────────────────────────┐
│ ✓ Good        ≤ 100ms               │  Отличная отзывчивость
│ ⚠ Needs Imp.  100ms - 300ms         │  Требует оптимизации
│ ✗ Poor        > 300ms               │  Критическая проблема
└─────────────────────────────────────┘

CLS (Cumulative Layout Shift)
┌─────────────────────────────────────┐
│ ✓ Good        ≤ 0.1                 │  Стабильный макет
│ ⚠ Needs Imp.  0.1 - 0.25            │  Требует оптимизации
│ ✗ Poor        > 0.25                │  Критическая проблема
└─────────────────────────────────────┘

INP (Interaction to Next Paint)
┌─────────────────────────────────────┐
│ ✓ Good        ≤ 200ms               │  Отличная отзывчивость
│ ⚠ Needs Imp.  200ms - 500ms         │  Требует оптимизации
│ ✗ Poor        > 500ms               │  Критическая проблема
└─────────────────────────────────────┘
```

---

## 💾 Хранилище данных

### Где хранятся данные

```
chrome.storage.local
└── metrics
    ├── tabId_1
    │   ├── url: "https://example.com"
    │   ├── latest: { lcp: 2100, fid: 45, cls: 0.08, ... }
    │   └── history: [ { name: 'lcp', value: 2100, timestamp: ... }, ... ]
    ├── tabId_2
    │   ├── url: "https://github.com"
    │   ├── latest: { lcp: 1800, fid: 30, cls: 0.05, ... }
    │   └── history: [ ... ]
    └── tabId_3
        ├── url: "https://google.com"
        ├── latest: { lcp: 2300, fid: 50, cls: 0.12, ... }
        └── history: [ ... ]
```

### Ограничения хранилища

- **Максимум 100 записей** в истории на сайт (старые удаляются)
- **Автоматическая очистка** данных старше 24 часов
- **Локальное хранилище** — данные не синхронизируются между устройствами
- **Очистка при удалении расширения** — все данные удаляются

---

## 🐛 Решение проблем

### Проблема: Метрики не показываются

**Решение:**
1. Обновите страницу (F5)
2. Подождите 2-3 секунды
3. Проверьте, включен ли JavaScript на сайте
4. Попробуйте другой сайт

### Проблема: Уведомления не приходят

**Решение:**
1. Откройте Settings (⚙️)
2. Убедитесь, что "Show notifications" включено
3. Проверьте, что пороги установлены правильно
4. Проверьте разрешения браузера на уведомления

### Проблема: Dashboard не загружается

**Решение:**
1. Обновите страницу (F5)
2. Очистите кэш браузера
3. Переустановите расширение

---

## 📚 Дополнительные ресурсы

- [Web Vitals Guide](https://web.dev/vitals/)
- [Chrome DevTools Performance](https://developer.chrome.com/docs/devtools/performance/)
- [MDN Performance API](https://developer.mozilla.org/en-US/docs/Web/API/Performance)
- [Extension Development](https://developer.chrome.com/docs/extensions/)

---

**Готово к использованию! Установите расширение и начните мониторить производительность вашего сайта! 🚀**
